name: Test Native Compilation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-native:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Native Compiler
      run: make native
      
    - name: Test Native Compilation
      run: |
        echo '#var x = 5' > test.sb
        echo '#var y = 10' >> test.sb
        echo '#print(x + y)' >> test.sb
        ./subc test.sb -S -o test.s
        
    - name: Verify Assembly Output
      run: |
        cat test.s
        test -f test.s
